#!/bin/bash

set -e -u -x

GIT_DUET_RELEASE='https://github.com/git-duet/git-duet/releases/download/0.6.0/linux_amd64.tar.gz'
NEOVIM_RELEASE='https://github.com/neovim/neovim/releases/download/v0.4.3/nvim-linux64.tar.gz'
GOLANG_RELEASE='https://dl.google.com/go/go1.14.1.linux-amd64.tar.gz'

# bare necessities
sudo apt install curl stow

# Yarn source
curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list

# update all sources
sudo apt update

# local executables dir
mkdir -p ~/bin

# Go
curl -L "$GOLANG_RELEASE" | sudo tar -C /usr/local -xzf -

# Git
stow -t ~ git
curl -L "$GIT_DUET_RELEASE" | tar -C ~/bin -zxf -

# Fish
stow -t ~ fish
sudo apt install fish fonts-powerline
fish -c 'fisher add rafaelrinaldi/pure rkbk60/onedark-fish jethrokuan/z tuvistavie/fish-ssh-agent'
sudo chsh -s /usr/bin/fish $(whoami)

# Neovim
stow -t ~ nvim
sudo mkdir -p /usr/local/nvim
curl -L "$NEOVIM_RELEASE" | sudo tar -C /usr/local/nvim -zxf - --strip-components=1
for alt in vi vim editor; do
  sudo update-alternatives --install /usr/bin/$alt $alt /usr/local/nvim/bin/nvim 60
  sudo update-alternatives --set $alt /usr/local/nvim/bin/nvim
done

# Python Neovim
sudo apt install python3-pip
sudo pip3 install pynvim

# Yarn
sudo apt install yarn
